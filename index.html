<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åæ–‡è¯†å­—é—¯å…³</title>
    <style>
        /* ç³–æœè‰²èƒŒæ™¯ */
        body {
            text-align: center;
            font-family: "Microsoft YaHei", "SimHei", sans-serif;
            background: linear-gradient(135deg, #FFDEE9 0%, #B5FFFC 100%);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            width: 90%;
            max-width: 550px;
            padding: 40px 20px;
            border-radius: 50px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            border: 10px solid #FFFFFF;
        }

        h2 { color: #FF7E5F; font-size: 32px; margin-bottom: 10px; text-shadow: 2px 2px 0px #FFEBB7; }
        #progress { color: #999; font-size: 14px; margin-bottom: 10px; font-weight: bold; }

        #word {
            font-size: 100px;
            margin: 15px 0;
            color: #333;
            font-weight: bold;
            text-shadow: 4px 4px 0px #FFD1D1;
            min-height: 130px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.2s;
        }

        #word.clickable { cursor: pointer; }
        #word.clickable:active { transform: scale(1.1); }

        #pinyin { font-size: 36px; color: #48C6EF; font-weight: bold; min-height: 45px; margin-bottom: 10px; }

        #status {
            font-size: 16px;
            color: #777;
            background: #F0F8FF;
            padding: 10px 20px;
            border-radius: 30px;
            margin-bottom: 20px;
            display: inline-block;
        }

        button {
            padding: 15px 35px; font-size: 22px; margin: 10px; border: none;
            border-radius: 40px; cursor: pointer; font-weight: bold;
            color: white; transition: all 0.2s; box-shadow: 0 8px 0px #CCC;
        }
        #startBtn { background-color: #ff9a9e; box-shadow: 0 8px 0px #f6416c; }
        #nextBtn { background-color: #667eea; box-shadow: 0 8px 0px #764ba2; }
        #hintBtn { background-color: #f6d365; box-shadow: 0 8px 0px #fda085; color: #666; }
        button:active { transform: translateY(4px); box-shadow: 0 2px 0px #CCC; }

        .reward-text {
            font-size: 38px;
            font-weight: bold;
            background: linear-gradient(to right, #ff4757, #ffa502, #2ed573, #1e90ff, #ff4757);
            -webkit-background-clip: text;
            color: transparent;
            margin: 20px auto;
            animation: pop 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes pop { 0% { transform: scale(0.5); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .watermark { position: fixed; bottom: 20px; right: 20px; font-size: 14px; color: #FF6B6B; background: rgba(255,255,255,0.6); padding: 5px 12px; border-radius: 20px; }
    </style>
</head>
<body>

<div class="card">
    <h2>ğŸ¦ åæ–‡è¯†å­—é—¯å…³ ğŸ¦</h2>
    <div id="progress">è¿›åº¦: 1 / 10</div>
    <div id="status">å‡†å¤‡å¥½äº†å—ï¼Ÿ</div>

    <div id="word">Ready?</div>
    <div id="pinyin"></div>
    <div id="reward"></div>

    <div id="btnGroup">
        <button onclick="initSystem()" id="startBtn">ğŸš€ å¼€å§‹é—¯å…³</button>
        <button onclick="showHint()" id="hintBtn" style="display:none;">ğŸ’¡ æ‹¼éŸ³æç¤º</button>
        <button onclick="nextWord()" id="nextBtn" style="display:none;">ä¸‹ä¸€å…³ âœ</button>
    </div>
</div>

<div class="watermark">ğŸ« å¸¸è€å¸ˆåæ–‡è¯¾å ‚</div>

<script>
const words = [
    {han:"å°é¸Ÿ", py:"xiÇo niÇo"}, {han:"ç«¹å­", py:"zhÃº zi"},
    {han:"å¤§è±¡", py:"dÃ  xiÃ ng"}, {han:"çˆ·çˆ·", py:"yÃ© ye"},
    {han:"å§å§", py:"jiÄ› jie"}, {han:"å¤ªé˜³", py:"tÃ i yÃ¡ng"},
    {han:"è€å¸ˆ", py:"lÇo shÄ«"}, {han:"è‹¹æœ", py:"pÃ­ng guÇ’"},
    {han:"è·‘æ­¥", py:"pÇo bÃ¹"}, {han:"å¿«ä¹", py:"kuÃ i lÃ¨"}
];

let index = 0;
let recognition;
let useMic = false;
let audioCtx;

function playSound(type) {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const osc = audioCtx.createOscillator();
    const gain = audioCtx.createGain();
    osc.connect(gain);
    gain.connect(audioCtx.destination);

    if (type === 'success') {
        osc.type = 'sine';
        osc.frequency.setValueAtTime(523.25, audioCtx.currentTime); 
        osc.frequency.exponentialRampToValueAtTime(880, audioCtx.currentTime + 0.1); 
        gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.4);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.4);
    } else {
        osc.type = 'sawtooth';
        osc.frequency.setValueAtTime(150, audioCtx.currentTime);
        gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
        gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
        osc.start();
        osc.stop(audioCtx.currentTime + 0.3);
    }
}

async function initSystem() {
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (audioCtx.state === 'suspended') audioCtx.resume();
    document.getElementById("startBtn").style.display = "none";
    
    try {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        if (!SpeechRecognition) throw new Error();
        await navigator.mediaDevices.getUserMedia({ audio: true });
        recognition = new SpeechRecognition();
        recognition.lang = "zh-CN";
        recognition.onresult = (event) => {
            let result = event.results[0][0].transcript.replace(/[ï¼Œã€‚ï¼Ÿï¼\s]/g, "");
            if (result.includes(words[index].han)) {
                success();
            } else {
                playSound('fail');
                document.getElementById("status").innerHTML = "å†è¯•ä¸€æ¬¡ï¼Œå¤§å£°ä¸€ç‚¹å“¦ï¼";
            }
        };
        recognition.onend = () => {
            if (useMic && document.getElementById("nextBtn").style.display === "none") {
                try { recognition.start(); } catch(e) {}
            }
        };
        useMic = true;
        document.getElementById("status").innerHTML = "ğŸ¤ éº¦å…‹é£å·²å¼€å¯ï¼Œè¯·æœ—è¯»";
    } catch (err) {
        useMic = false;
        document.getElementById("status").innerHTML = "ğŸ‘‡ è¯·è¯»å®Œåï¼Œç‚¹å‡»æ±‰å­—é€šå…³";
        document.getElementById("word").classList.add("clickable");
        document.getElementById("word").onclick = () => {
            if (document.getElementById("nextBtn").style.display === "none") success();
        };
    }
    showWord();
}

function showWord() {
    if (index >= words.length) { finishGame(); return; }
    document.getElementById("progress").innerText = `è¿›åº¦: ${index + 1} / ${words.length}`;
    document.getElementById("word").innerText = words[index].han;
    document.getElementById("pinyin").innerText = "";
    document.getElementById("reward").innerHTML = "";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("hintBtn").style.display = "inline-block";
    if (useMic) { try { recognition.start(); } catch(e) {} }
}

function success() {
    playSound('success');
    document.getElementById("pinyin").innerText = words[index].py;
    document.getElementById("status").innerHTML = "ğŸ‰ è¯»å¯¹å•¦ï¼";
    document.getElementById("reward").innerHTML = `<div class="reward-text">â­ å¤ªæ£’äº† â­</div>`;
    document.getElementById("nextBtn").style.display = "inline-block";
    document.getElementById("hintBtn").style.display = "none";
}

function nextWord() {
    index++;
    showWord();
}

function showHint() {
    document.getElementById("pinyin").innerText = words[index].py;
}

function finishGame() {
    document.getElementById("word").innerHTML = "ğŸ†";
    document.getElementById("pinyin").innerText = "";
    document.getElementById("status").innerHTML = "å…¨éƒ¨é€šå…³å•¦ï¼";
    document.getElementById("reward").innerHTML = "<div class='reward-text'>ğŸ‘‘ è¯†å­—å°æ˜æ˜Ÿ ğŸ‘‘</div>";
    document.getElementById("nextBtn").style.display = "none";
    document.getElementById("hintBtn").style.display = "none";
}
</script>

</body>
</html>